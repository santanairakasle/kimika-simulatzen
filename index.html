<!DOCTYPE html>
<html lang="eu">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Erreaktibo mugatzailea: Simulazioa</title>
ย ย <style>
ย ย ย ย /* ======================================== */
ย ย ย ย /* ESTILOS CSS */
ย ย ย ย /* ======================================== */
ย ย ย ย body {ย
ย ย ย ย ย ย font-family: Arial, sans-serif;ย
ย ย ย ย ย ย margin: 0;ย
ย ย ย ย ย ย padding: 0;ย
ย ย ย ย ย ย background-color: #fce4ec; /* Rosa claro */
ย ย ย ย ย ย color: #333;ย
ย ย ย ย }
ย ย ย ย .container {ย
ย ย ย ย ย ย max-width: 900px;ย
ย ย ย ย ย ย margin: 20px auto;ย
ย ย ย ย ย ย background-color: #fff;ย
ย ย ย ย ย ย padding: 25px;ย
ย ย ย ย ย ย border-radius: 10px;ย
ย ย ย ย ย ย box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);ย
ย ย ย ย }
ย ย ย ย h1 {ย
ย ย ย ย ย ย color: #d81b60;ย
ย ย ย ย ย ย text-align: center;ย
ย ย ย ย ย ย border-bottom: 2px solid #d81b60;ย
ย ย ย ย ย ย padding-bottom: 10px;ย
ย ย ย ย ย ย margin-bottom: 20px;ย
ย ย ย ย }
ย ย ย ย h2 {ย
ย ย ย ย ย ย color: #43a047;ย
ย ย ย ย ย ย border-bottom: 1px solid #ddd;ย
ย ย ย ย ย ย padding-bottom: 5px;ย
ย ย ย ย ย ย margin-top: 25px;ย
ย ย ย ย }
ย ย ย ย .input-group, .resultado-item {ย
ย ย ย ย ย ย margin-bottom: 15px;ย
ย ย ย ย ย ย padding: 10px;ย
ย ย ย ย ย ย border: 1px solid #ccc;ย
ย ย ย ย ย ย border-radius: 5px;ย
ย ย ย ย }
ย ย ย ย label {ย
ย ย ย ย ย ย display: block;ย
ย ย ย ย ย ย margin-bottom: 5px;ย
ย ย ย ย ย ย font-weight: bold;ย
ย ย ย ย }
ย ย ย ย input[type="text"], input[type="number"], select {ย
ย ย ย ย ย ย width: calc(100% - 22px);ย
ย ย ย ย ย ย padding: 10px;ย
ย ย ย ย ย ย border: 1px solid #ddd;ย
ย ย ย ย ย ย border-radius: 4px;ย
ย ย ย ย ย ย box-sizing: border-box;ย
ย ย ย ย ย ย margin-top: 5px;ย
ย ย ย ย }
ย ย ย ย select {ย
ย ย ย ย ย ย ยwidth: 100%;ย
ย ย ย ย ย ย ยmargin-top: 5px;ย
ย ย ย ย }
ย ย ย ย button {ย
ย ย ย ย ย ย background-color: #d81b60;ย
ย ย ย ย ย ย color: white;ย
ย ย ย ย ย ย padding: 10px 15px;ย
ย ย ย ย ย ย border: none;ย
ย ย ย ย ย ย border-radius: 5px;ย
ย ย ย ย ย ย cursor: pointer;ย
ย ย ย ย ย ย font-size: 16px;ย
ย ย ย ย ย ย transition: background-color 0.3s;ย
ย ย ย ย ย ย margin-top: 10px;ย
ย ย ย ย }
ย ย ย ย button:hover {ย
ย ย ย ย ย ย background-color: #c2185b;ย
ย ย ย ย }
ย ย ย ย #visualizazioa {ย
ย ย ย ย ย ย background-color: #f8bbd0;ย
ย ย ย ย ย ย padding: 20px;ย
ย ย ย ย ย ย border-radius: 8px;ย
ย ย ย ย ย ย min-height: 80px;ย
ย ย ย ย ย ย margin-top: 20px;ย
ย ย ย ย ย ย font-size: 1.1em;ย
ย ย ย ย ย ย color: #666;ย
ย ย ย ย ย ย border: 1px dashed #d81b60;ย
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย flex-direction: column;
ย ย ย ย ย ย gap: 10px;
ย ย ย ย }
ย ย ย ย .resultado-valor {ย
ย ย ย ย ย ย font-weight: bold;ย
ย ย ย ย ย ย color: #1e88e5;ย
ย ย ย ย ย ย font-size: 1.1em;ย
ย ย ย ย }
ย ย ย ย .rl-limitante {
ย ย ย ย ย ย color: #d81b60;ย
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย }
ย ย ย ย .input-inline {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย gap: 10px;
ย ย ย ย ย ย margin-top: 10px;
ย ย ย ย }
ย ย ย ย .input-inline div {
ย ย ย ย ย ย flex: 1;
ย ย ย ย }

ย ย ย ย /* ESTILOS PARA LA SIMULACIรN SIMBรLICA */
ย ย ย ย .simulazio-linea {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: space-between;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย padding: 5px 0;
ย ย ย ย ย ย border-bottom: 1px dotted #d81b60;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย }
ย ย ย ย .simulazio-linea:last-child {
ย ย ย ย ย ย border-bottom: none;
ย ย ย ย }
ย ย ย ย .simulazio-izena {
ย ย ย ย ย ย flex: 1;
ย ย ย ย ย ย text-align: left;
ย ย ย ย ย ย padding-left: 10px;
ย ย ย ย }
ย ย ย ย .simulazio-egoera {
ย ย ย ย ย ย flex: 1;
ย ย ย ย ย ย text-align: right;
ย ย ย ย ย ย padding-right: 10px;
ย ย ย ย }
ย ย ย ย .agotado {
ย ย ย ย ย ย color: #d81b60; /* Rojo/Rosa oscuro */
ย ย ย ย ย ย animation: pulse-agotado 1.5s infinite;
ย ย ย ย }
ย ย ย ย .sobran {
ย ย ย ย ย ย color: #43a047; /* Verde */
ย ย ย ย }
ย ย ย ย .produktua {
ย ย ย ย ย ย color: #1e88e5; /* Azul */
ย ย ย ย }
ย ย ย ย @keyframes pulse-agotado {
ย ย ย ย ย ย 0% { opacity: 1; }
ย ย ย ย ย ย 50% { opacity: 0.5; }
ย ย ย ย ย ย 100% { opacity: 1; }
ย ย ย ย }

ย ย </style>
</head>
<body>

ย ย <div class="container">
ย ย ย ย <h1>Erreaktibo mugatzailea ๐งช</h1>
ย ย ย ย <p style="text-align: center; font-style: italic;">Erreakzio kimikoen simulazioa eta kalkulua</p>

ย ย ย ย <h2>1. Erreakzioaren Konfigurazioa</h2>

ย ย ย ย <div class="input-group">
ย ย ย ย ย ย <label for="ekuazioa">Ekuazio Kimikoa (Adib.: N2 + 3H2 -> 2NH3)</label>
ย ย ย ย ย ย <input type="text" id="ekuazioa" placeholder="Idatzi ekuazioa doituta hemen..." value="N2 + 3H2 -> 2NH3">
ย ย ย ย ย ย <button onclick="alert('Garrantzitsua: Simulazioa egiteko, Ekuazio Kimikoa DOITUTA sartu behar da. Egiaztatu zuk zeuk koefizienteak zuzenak direla.')">Ekuazioa Doituta dago?</button>
ย ย ย ย </div>

ย ย ย ย <div class="input-group">
ย ย ย ย ย ย <h3>Hasierako Kantitateak</h3>

ย ย ย ย ย ย <label for="erreaktibo1_kantitatea">1. Erreaktiboa:</label>
ย ย ย ย ย ย <input type="number" id="erreaktibo1_kantitatea" placeholder="Sartu kantitatea" value="10" min="0">
ย ย ย ย ย ย <select id="erreaktibo1_unitatea">
ย ย ย ย ย ย ย ย <option value="gramoak">Gramoak (g)</option>
ย ย ย ย ย ย ย ย <option value="molak">Molak (mol)</option>
ย ย ย ย ย ย ย ย <option value="mililitroak">Mililitroak (ml)</option>
ย ย ย ย ย ย ย ย <option value="litroak">Litroak (L)</option>
ย ย ย ย ย ย </select>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div class="input-inline">
ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย <label for="erreaktibo1_dentsitatea">Dentsitatea (g/mL, aukerakoa):</label>
ย ย ย ย ย ย ย ย ย ย <input type="number" id="erreaktibo1_dentsitatea" placeholder="1.0" min="0">
ย ย ย ย ย ย ย ย </div>
                <div>
ย ย ย ย ย ย ย ย ย ย <label for="erreaktibo1_molaritatea">Molaritatea (mol/L, aukerakoa):</label>
ย ย ย ย ย ย ย ย ย ย <input type="number" id="erreaktibo1_molaritatea" placeholder="0.1" min="0">
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย <label for="erreaktibo1_pureza">Purutasuna (%, aukerakoa):</label>
ย ย ย ย ย ย ย ย ย ย <input type="number" id="erreaktibo1_pureza" placeholder="100" min="0" max="100">
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>

ย ย ย ย <div class="input-group">
ย ย ย ย ย ย <label for="erreaktibo2_kantitatea">2. Erreaktiboa:</label>
ย ย ย ย ย ย <input type="number" id="erreaktibo2_kantitatea" placeholder="Sartu kantitatea" value="10" min="0">
ย ย ย ย ย ย <select id="erreaktibo2_unitatea">
ย ย ย ย ย ย ย ย <option value="gramoak">Gramoak (g)</option>
ย ย ย ย ย ย ย ย <option value="molak">Molak (mol)</option>
ย ย ย ย ย ย ย ย <option value="mililitroak">Mililitroak (ml)</option>
ย ย ย ย ย ย ย ย <option value="litroak">Litroak (L)</option>
ย ย ย ย ย ย </select>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div class="input-inline">
ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย <label for="erreaktibo2_dentsitatea">Dentsitatea (g/mL, aukerakoa):</label>
ย ย ย ย ย ย ย ย ย ย <input type="number" id="erreaktibo2_dentsitatea" placeholder="1.0" min="0">
ย ย ย ย ย ย ย ย </div>
                <div>
ย ย ย ย ย ย ย ย ย ย <label for="erreaktibo2_molaritatea">Molaritatea (mol/L, aukerakoa):</label>
ย ย ย ย ย ย ย ย ย ย <input type="number" id="erreaktibo2_molaritatea" placeholder="0.1" min="0">
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย <label for="erreaktibo2_pureza">Purutasuna (%, aukerakoa):</label>
ย ย ย ย ย ย ย ย ย ย <input type="number" id="erreaktibo2_pureza" placeholder="100" min="0" max="100">
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>

ย ย ย ย <button onclick="hasiSimulazioa()">Hasi Simulazioa</button>

ย ย ย ย <h2>2. Simulazioa</h2>
ย ย ย ย <div id="visualizazioa">
ย ย ย ย ย ย Kargatu hasierako datuak simulazioa ikusteko...
ย ย ย ย </div>

ย ย ย ย <h2>3. Emaitzak eta Kalkuluak</h2>

ย ย ย ย <div class="input-group" id="emaitzak_panela">
ย ย ย ย ย ย <div class="resultado-item">
ย ย ย ย ย ย ย ย <label>Erreaktibo Mugatzailea (EM):</label>
ย ย ย ย ย ย ย ย <p id="em_izena" class="resultado-valor rl-limitante">...</p>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div class="resultado-item">
ย ย ย ย ย ย ย ย <label>Gehiegizko erreaktiboa (GE):</label>
ย ย ย ย ย ย ย ย <p id="se_izena">...</p>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div class="resultado-item">
ย ย ย ย ย ย ย ย <label>GE-ren Geratzen den Kantitatea:</label>
ย ย ย ย ย ย ย ย <p id="se_kantitatea" class="resultado-valor">...</p>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <div class="resultado-item">
ย ย ย ย ย ย ย ย <label>Sortzen den Produktua:</label>
ย ย ย ย ย ย ย ย <p id="produktuaren_kantitatea" class="resultado-valor"></p>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย ย ยย
ย ย </div>

ย ย <script>
ย ย ย ย // 1. CONSTANTES Y BASES DE DATOS
ย ย ย ยย
ย ย ย ย const MASAS_ATOMICAS = {
ย ย ย ย ย ย 'H': 1.008, 'He': 4.003, 'Li': 6.94, 'Be': 9.012, 'B': 10.81, 'C': 12.011, 'N': 14.007, 'O': 15.999,
ย ย ย ย ย ย 'F': 18.998, 'Ne': 20.180, 'Na': 22.990, 'Mg': 24.305, 'Al': 26.982, 'Si': 28.085, 'P': 30.974,
ย ย ย ย ย ย 'S': 32.06, 'Cl': 35.45, 'Ar': 39.948, 'K': 39.098, 'Ca': 40.078, 'Fe': 55.845, 'Cu': 63.546,
ย ย ย ย ย ย 'I': 126.904, 'Br': 79.904, 'Ba': 137.33,
ย ย ย ย };

ย ย ย ย const MASA_MOLAR_CACHE = {};ย

ย ย ย ย // 2. FUNCIรN PRINCIPAL DE SIMULACIรN

ย ย ย ย function hasiSimulazioa() {
ย ย ย ย ย ย // 2.1. Recoger datos de la ecuaciรณn
ย ย ย ย ย ย const ekuazioaStr = document.getElementById('ekuazioa').value.trim();
ย ย ย ย ย ยย
ย ย ย ย ย ย // 2.2. Recoger datos del Reactivo 1
ย ย ย ย ย ย const kant1 = parseFloat(document.getElementById('erreaktibo1_kantitatea').value);
ย ย ย ย ย ย const unitate1 = document.getElementById('erreaktibo1_unitatea').value;
ย ย ย ย ย ย const dentsitate1Str = document.getElementById('erreaktibo1_dentsitatea').value;
            const molaritatea1Str = document.getElementById('erreaktibo1_molaritatea').value;
ย ย ย ย ย ย const pureza1Str = document.getElementById('erreaktibo1_pureza').value;
ย ย ย ย ย ยย
ย ย ย ย ย ย // 2.3. Recoger datos del Reactivo 2
ย ย ย ย ย ย const kant2 = parseFloat(document.getElementById('erreaktibo2_kantitatea').value);
ย ย ย ย ย ย const unitate2 = document.getElementById('erreaktibo2_unitatea').value;
ย ย ย ย ย ย const dentsitate2Str = document.getElementById('erreaktibo2_dentsitatea').value;
            const molaritatea2Str = document.getElementById('erreaktibo2_molaritatea').value;
ย ย ย ย ย ย const pureza2Str = document.getElementById('erreaktibo2_pureza').value;

ย ย ย ย ย ย // Limpieza de datos opcionales
ย ย ย ย ย ย const dentsitate1 = dentsitate1Str ? parseFloat(dentsitate1Str) : null;
            const molaritatea1 = molaritatea1Str ? parseFloat(molaritatea1Str) : null;
ย ย ย ย ย ย const pureza1 = pureza1Str ? parseFloat(pureza1Str) : 100;ย
ย ย ย ย ย ย const dentsitate2 = dentsitate2Str ? parseFloat(dentsitate2Str) : null;
            const molaritatea2 = molaritatea2Str ? parseFloat(molaritatea2Str) : null;
ย ย ย ย ย ย const pureza2 = pureza2Str ? parseFloat(pureza2Str) : 100;
ย ย ย ย ย ยย
ย ย ย ย ย ย // Validaciones bรกsicas
ย ย ย ย ย ย document.getElementById('visualizazioa').textContent = 'Kargatzen...';
ย ย ย ย ย ย if (isNaN(kant1) || isNaN(kant2) || kant1 <= 0 || kant2 <= 0 || pureza1 > 100 || pureza2 > 100 || pureza1 < 0 || pureza2 < 0) {
ย ย ย ย ย ย ย ย document.getElementById('visualizazioa').textContent = 'Errorea: Sartu kantitate, dentsitate, molaritate eta purutasuna balio positiboak (purutasuna 0 eta 100 artean).'; return;
ย ย ย ย ย ย }

ย ย ย ย ย ย // Parsear Ecuaciรณn
ย ย ย ย ย ย const { erreaktiboak, produktuak } = parseEkuazioa(ekuazioaStr);
ย ย ย ย ย ย if (erreaktiboak.length !== 2 || produktuak.length === 0) {
ย ย ย ย ย ย ย ย document.getElementById('visualizazioa').textContent = 'Errorea: Ekuazio formatu okerra (A + B -> C). Konprobatu ekuazioa doituta dagoela.'; return;
ย ย ย ย ย ย }

ย ย ย ย ย ย // 3. OBTENER MASAS MOLARES Y CALCULAR MOLES
ย ย ย ย ย ย const formula1 = erreaktiboak[0].formula;
ย ย ย ย ย ย const masaMolar1 = kalkulatuMasaMolarra(formula1);
ย ย ย ย ย ย const molak1 = kalkulatuMolak(masaMolar1, kant1, unitate1, dentsitate1, molaritatea1, pureza1);

ย ย ย ย ย ย const formula2 = erreaktiboak[1].formula;
ย ย ย ย ย ย const masaMolar2 = kalkulatuMasaMolarra(formula2);
ย ย ย ย ย ย const molak2 = kalkulatuMolak(masaMolar2, kant2, unitate2, dentsitate2, molaritatea2, pureza2);
ย ย ย ย ย ยย
ย ย ย ย ย ย if (molak1 === null || molak2 === null) {
ย ย ย ย ย ย ย ย document.getElementById('visualizazioa').textContent = `Errorea: Ezin da kantitatea mol bihurtu. Konprobatu elementu kimikoak zuzen idatzita daudela eta MASAS_ATOMICAS datu-basean daudela (edo dentsitate/molaritate balioak).`;ย
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }

ย ย ย ย ย ย // 4. IDENTIFICAR EL REACTIVO LIMITANTE (EM)
ย ย ย ย ย ย const ratio1 = molak1 / erreaktiboak[0].koefizientea;
ย ย ย ย ย ย const ratio2 = molak2 / erreaktiboak[1].koefizientea;

ย ย ย ย ย ย let molRL, formulaRL, molRE, formulaRE, koefRL, koefRE;

ย ย ย ย ย ย if (ratio1 < ratio2) {
ย ย ย ย ย ย ย ย // Reactivo 1 es RL
ย ย ย ย ย ย ย ย molRL = molak1; formulaRL = formula1; koefRL = erreaktiboak[0].koefizientea;
ย ย ย ย ย ย ย ย molRE = molak2; formulaRE = formula2; koefRE = erreaktiboak[1].koefizientea;
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย // Reactivo 2 es RL
ย ย ย ย ย ย ย ย molRL = molak2; formulaRL = formula2; koefRL = erreaktiboak[1].koefizientea;
ย ย ย ย ย ย ย ย molRE = molak1; formulaRE = formula1; koefRE = erreaktiboak[0].koefizientea;ย
ย ย ย ย ย ย }

ย ย ย ย ย ย // 5. CALCULAR RESULTADOS (EXCESO Y PRODUCTO)
ย ย ย ย ย ยย
ย ย ย ย ย ย // Exceso
ย ย ย ย ย ย const molakKontsumituRE = (molRL * koefRE) / koefRL;
ย ย ย ย ย ย const molakSoberanRE = molRE - molakKontsumituRE;
ย ย ย ย ย ย const masaMolarRE = kalkulatuMasaMolarra(formulaRE);
ย ย ย ย ย ย const masaSoberanRE = molakSoberanRE * (masaMolarRE || 0);

ย ย ย ย ย ย // Producto (Sortzen den Produktua)
ย ย ย ย ย ย const produktuarenFormula = produktuak[0].formula;
ย ย ย ย ย ย const koefProduktua = produktuak[0].koefizientea;
ย ย ย ย ย ย const masaMolarProduktua = kalkulatuMasaMolarra(produktuarenFormula);
ย ย ย ย ย ยย
ย ย ย ย ย ย if (!masaMolarProduktua) {
ย ย ย ย ย ย ย ย ยdocument.getElementById('visualizazioa').textContent = `Errorea: Produktuaren masa molarra ezin da kalkulatu ${produktuarenFormula}-rentzat.`; return;
ย ย ย ย ย ย }

ย ย ย ย ย ย const molakProduktua = (molRL * koefProduktua) / koefRL;
ย ย ย ย ย ย const masaProduktua = molakProduktua * masaMolarProduktua;


ย ย ย ย ย ย // 6. BISTARATU EMAITZAK (Mostrar Resultados)
ย ย ย ย ย ย bistaratuEmaitzak(formulaRL, formulaRE, molakSoberanRE, masaSoberanRE, molakProduktua, masaProduktua, produktuarenFormula);
ย ย ย ย }

ย ย ย ย // 7. FUNTZIO OSAGARRIAK
ย ย ย ยย
ย ย ย ย /**
ย ย ย ย ย* Convierte la cantidad de entrada a moles (maneja g, mol, ml, L, con pureza, densidad y molaridad).
ย ย ย ย ย*/
ย ย ย ย function kalkulatuMolak(masaMolar, kantitatea, unitatea, dentsitatea, molaritatea, pureza) {
ย ย ย ย ย ย ย ย ย ย
ย ย ย ย ย ย if (unitatea === 'molak') {
ย ย ย ย ย ย ย ย // El valor ya estรก en moles, aplicar pureza si es necesario.
ย ย ย ย ย ย ย ย return kantitatea * (pureza / 100);
ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย
ย ย ย ย ย ย let masaGramoak = 0; // Para cรกlculos de masa (g) y densidad/volumen

ย ย ย ย ย ย if (unitatea === 'litroak' || unitatea === 'mililitroak') {
ย ย ย ย ย ย ย ย const bolumenaLitroak = (unitatea === 'litroak') ? kantitatea : kantitatea / 1000;
ย ย ย ย ย ย ย ย 
ย ย ย ย ย ย ย ย if (molaritatea !== null && molaritatea > 0) {
ย ย ย ย ย ย ย ย ย ย // PRIORIDAD: USAR MOLARIDAD: n = M * V (moles = Molaridad * Volumen en L)
ย ย ย ย ย ย ย ย ย ย return bolumenaLitroak * molaritatea; 
ย ย ย ย ย ย ย ย } 
ย ย ย ย ย ย ย ย 
ย ย ย ย ย ย ย ย // Si no hay molaridad, volvemos a la lรณgica de Densidad
ย ย ย ย ย ย ย ย if (dentsitatea === null || isNaN(dentsitatea) || dentsitatea <= 0) {
ย ย ย ย ย ย ย ย ย ย alert('Errorea: Bolumena aukeratu duzu, baina ez da Dentsitatea (g/mL) EZ Molaritatea (mol/L) sartu edo ez da balioduna.');
ย ย ย ย ย ย ย ย ย ย return null;
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย // CรLCULO con DENSIDAD (m = ฯ * V)
ย ย ย ย ย ย ย ย let bolumenaML = (unitatea === 'litroak') ? kantitatea * 1000 : kantitatea;
ย ย ย ย ย ย ย ย masaGramoak = bolumenaML * dentsitatea;
ย ย ย ย ย ย ย ย 
ย ย ย ย ย ย } else if (unitatea === 'gramoak') {
ย ย ย ย ย ย ย ย masaGramoak = kantitatea;
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย return null;
ย ย ย ย ย ย }

ย ย ย ย ย ย // Convertir a Moles (para unidades de Masa o Densidad)
ย ย ย ย ย ย if (!masaMolar) return null;

ย ย ย ย ย ย // Aplicar pureza a la masa total (solo si no se usรณ Molaridad)
ย ย ย ย ย ย const masaPurua = masaGramoak * (pureza / 100);

ย ย ย ย ย ย return masaPurua / masaMolar; // n = masa_pura / masa_molar
ย ย ย ย }


ย ย ย ย /**
ย ย ย ย ย* Analiza una fรณrmula quรญmica, incluyendo parรฉntesis, y calcula su masa molar.
ย ย ย ย ย* @param {string} formula La fรณrmula quรญmica (ej: Ca(OH)2, N2)
ย ย ย ย ย* @returns {number | null} La masa molar o null si hay un error
ย ย ย ย ย*/
ย ย ย ย function kalkulatuMasaMolarra(formula) {
ย ย ย ย ย ย if (MASA_MOLAR_CACHE[formula]) return MASA_MOLAR_CACHE[formula];

ย ย ย ย ย ย let masaMolar = 0;
ย ย ย ย ย ย let isValid = true;
ย ย ย ย ย ยย
ย ย ย ย ย ย // Paso 1: Reemplazar parรฉntesis por su contenido expandido
ย ย ย ย ย ย let formulaExpandida = formula;
ย ย ย ย ย ยย
ย ย ย ย ย ย const parentesisRegex = /\(([A-Za-z0-9]+)\)(\d+)/g;

ย ย ย ย ย ย while (parentesisRegex.test(formulaExpandida)) {
ย ย ย ย ย ย ย ย formulaExpandida = formulaExpandida.replace(parentesisRegex, (match, contenido, subindiceStr) => {
ย ย ย ย ย ย ย ย ย ย const subindice = parseInt(subindiceStr);
ย ย ย ย ย ย ย ย ย ย if (isNaN(subindice)) return match;ย
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย let contenidoExpandido = "";
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const elementoInternoRegex = /([A-Z][a-z]*)(\d*)/g;
ย ย ย ย ย ย ย ย ย ย let matchInterno;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย while ((matchInterno = elementoInternoRegex.exec(contenido)) !== null) {
ย ย ย ย ย ย ย ย ย ย ย ย const simbolo = matchInterno[1];
ย ย ย ย ย ย ย ย ย ย ย ย const subindiceInterno = matchInterno[2] === '' ? 1 : parseInt(matchInterno[2]);
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย const nuevoSubindice = subindiceInterno * subindice;
ย ย ย ย ย ย ย ย ย ย ย ย contenidoExpandido += simbolo + (nuevoSubindice > 1 ? nuevoSubindice : '');
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย return contenidoExpandido;
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย }

ย ย ย ย ย ย // Paso 2: Calcular la masa molar de la fรณrmula expandida (sin parรฉntesis)
ย ย ย ย ย ย const regexFinal = /([A-Z][a-z]*)(\d*)/g;
ย ย ย ย ย ย let match;
ย ย ย ย ย ยย
ย ย ย ย ย ย while ((match = regexFinal.exec(formulaExpandida)) !== null) {
ย ย ย ย ย ย ย ย const elementSymbol = match[1];
ย ย ย ย ย ย ย ย const subscript = match[2] === '' ? 1 : parseInt(match[2]);
ย ย ย ย ย ย ย ย const atomicMass = MASAS_ATOMICAS[elementSymbol];

ย ย ย ย ย ย ย ย if (!atomicMass) {
ย ย ย ย ย ย ย ย ย ย isValid = false;
ย ย ย ย ย ย ย ย ย ย break;ย
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย masaMolar += atomicMass * subscript;
ย ย ย ย ย ย }

ย ย ย ย ย ย if (!isValid || masaMolar === 0) return null;

ย ย ย ย ย ย MASA_MOLAR_CACHE[formula] = masaMolar;
ย ย ย ย ย ย return masaMolar;
ย ย ย ย }

ย ย ย ย // Funciรณn de parseo de la ecuaciรณn (Mantenida)
ย ย ย ย function parseEkuazioa(ekuazioaStr) {
ย ย ย ย ย ย const parts = ekuazioaStr.split('->');
ย ย ย ย ย ย if (parts.length !== 2) return { erreaktiboak: [], produktuak: [] };

ย ย ย ย ย ย const parsePart = (partStr) => {
ย ย ย ย ย ย ย ย return partStr.split('+').map(item => {
ย ย ย ย ย ย ย ย ย ย item = item.trim();
ย ย ย ย ย ย ย ย ย ย const match = item.match(/^(\d*)(\D.*)$/);
ย ย ย ย ย ย ย ย ย ย let koefizientea = 1;
ย ย ย ย ย ย ย ย ย ย let formula = item;
ย ย ย ย ย ย ย ย ย ย if (match) {
ย ย ย ย ย ย ย ย ย ย ย ย koefizientea = match[1] === '' ? 1 : parseInt(match[1]);
ย ย ย ย ย ย ย ย ย ย ย ย formula = match[2].trim();
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย return { koefizientea, formula };
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย };
ย ย ย ย ย ย return {
ย ย ย ย ย ย ย ย erreaktiboak: parsePart(parts[0].trim()),
ย ย ย ย ย ย ย ย produktuak: parsePart(parts[1].trim())
ย ย ย ย ย ย };
ย ย ย ย }

ย ย ย ย // FUNCIรN DE BISTARATZE MEJORADAย
ย ย ย ย function bistaratuEmaitzak(formulaRL, formulaRE, molakSoberanRE, masaSoberanRE, molakProduktua, masaProduktua, produktuarenFormula) {
ย ย ย ย ย ย const format = (num) => num.toFixed(3);
ย ย ย ย ย ย const masaSoberanStr = molakSoberanRE > 0 ? `(${format(masaSoberanRE)} g)` : '';
ย ย ย ย ย ย const molSoberanStr = format(Math.max(0, molakSoberanRE));

ย ย ย ย ย ย // Actualizar resultados numรฉricos
ย ย ย ย ย ย document.getElementById('em_izena').textContent = `${formulaRL}`;
ย ย ย ย ย ย document.getElementById('se_izena').textContent = `${formulaRE}`;ย
ย ย ย ย ย ย document.getElementById('se_kantitatea').textContent =ย
ย ย ย ย ย ย ย ย molakSoberanRE > 0 ? `${molSoberanStr} mol ${masaSoberanStr}` : '0.000 mol (Ez dago gehiegizkorik)';
ย ย ย ย ย ยย
ย ย ย ย ย ย // Actualizar cantidad de producto
ย ย ย ย ย ย document.getElementById('produktuaren_kantitatea').textContent =
ย ย ย ย ย ย ย ย `${format(molakProduktua)} mol ${produktuarenFormula} (${format(masaProduktua)} g)`;

ย ย ย ย ย ย // Generar contenido para la visualizaciรณn simbรณlica
ย ย ย ย ย ย let htmlSimulazioa = `
ย ย ย ย ย ย ย ย <div class="simulazio-linea">
ย ย ย ย ย ย ย ย ย ย <span class="simulazio-izena">${formulaRL}</span>
ย ย ย ย ย ย ย ย ย ย <span class="simulazio-egoera agotado">โ AGORTU DA (EM)</span>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="simulazio-linea">
ย ย ย ย ย ย ย ย ย ย <span class="simulazio-izena">${formulaRE}</span>
ย ย ย ย ย ย ย ย ย ย <span class="simulazio-egoera ${molakSoberanRE > 0 ? 'sobran' : 'agotado'}">
ย ย ย ย ย ย ย ย ย ย ย ย ${molakSoberanRE > 0 ? `โ GEHIEGIZKOA DAGO (${molSoberanStr} mol)` : 'โ ERE AGORTU DA (Stoichiometric)'}
ย ย ย ย ย ย ย ย ย ย </span>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="simulazio-linea">
ย ย ย ย ย ย ย ย ย ย <span class="simulazio-izena">${produktuarenFormula}</span>
ย ย ย ย ย ย ย ย ย ย <span class="simulazio-egoera produktua">โก๏ธ SORTU DA (${format(molakProduktua)} mol)</span>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `;
ย ย ย ย ย ยย
ย ย ย ย ย ย document.getElementById('visualizazioa').innerHTML = htmlSimulazioa;
ย ย ย ย }
ย ย </script>

</body>
</html>